<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>OpenVPN UI</title>
  <style>
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .login-box {
      background: white;
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      width: 100%;
      max-width: 400px;
    }
    .login-box h2 {
      text-align: center;
      margin-bottom: 30px;
      color: #333;
    }
    .login-box .form-control {
      margin-bottom: 15px;
    }
    .login-box .btn-login {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      color: white;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
    }
    .login-box .btn-login:hover {
      opacity: 0.9;
    }
    .login-box .btn-login:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .login-error {
      color: #dc3545;
      text-align: center;
      margin-bottom: 15px;
      font-size: 14px;
    }
    .loading-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: #f5f5f5;
    }
    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #f3f3f3;
      border-top: 5px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      margin-bottom: 20px;
    }
    .header-bar h4 {
      margin: 0;
    }
    .header-bar .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .header-bar .btn-logout {
      background: rgba(255,255,255,0.2);
      border: 1px solid rgba(255,255,255,0.5);
      color: white;
      padding: 5px 15px;
      border-radius: 5px;
      cursor: pointer;
    }
    .header-bar .btn-logout:hover {
      background: rgba(255,255,255,0.3);
    }
    .dashboard-container {
      padding: 0 20px 20px;
    }
  </style>
</head>
<body>
<script src="dist/style.min.js"></script>
<div id="app">
  <!-- Loading State -->
  <div v-if="isLoading" class="loading-container">
    <div class="spinner"></div>
  </div>

  <!-- Login Page -->
  <div v-if="!isLoading && !isAuthenticated" class="login-container">
    <div class="login-box">
      <h2>OpenVPN UI</h2>
      <form @submit.prevent="login">
        <input
          type="text"
          class="form-control"
          placeholder="Username"
          v-model="loginForm.username"
          required
          autofocus
        >
        <input
          type="password"
          class="form-control"
          placeholder="Password"
          v-model="loginForm.password"
          required
        >
        <div v-if="loginForm.error" class="login-error">
          {{ loginForm.error }}
        </div>
        <button type="submit" class="btn-login" :disabled="loginForm.loading">
          {{ loginForm.loading ? 'Logging in...' : 'Login' }}
        </button>
      </form>
    </div>
  </div>

  <!-- Dashboard -->
  <div v-if="!isLoading && isAuthenticated">
    <div class="header-bar">
      <h4>OpenVPN UI</h4>
      <div class="user-info">
        <span>{{ currentUser }}</span>
        <button class="btn-logout" @click="logout">Logout</button>
      </div>
    </div>

    <div class="dashboard-container">
      <vue-good-table
        :columns="columns"
        :rows="filteredRows"
        :line-numbers="true"
        :row-style-class="rowStyleClassFn"
        :search-options="{ enabled: true}" >
        <div slot="table-actions">
          <button type="button" class="btn btn-sm btn-success el-square" v-show="serverRole == 'master'" v-on:click.stop="u.modalNewUserVisible=true">Add user</button>
          <button type="button" class="btn btn-sm btn-secondary el-square" v-on:click.stop="filters.hideRevoked=!filters.hideRevoked;this.$cookies.set('hideRevoked',!(this.$cookies.get('hideRevoked') == 'true'), -1);">{{ revokeFilterText }}</button>
        </div>
        <div slot="emptystate" class="d-flex justify-content-center">
          <h4>No users have been created yet.</h4>
          <br>
          <button type="button" class="btn btn-sm btn-success el-square" v-if="serverRole == 'master'" v-on:click.stop="u.modalNewUserVisible=true">Add user</button>
        </div>
        <template slot="table-row" slot-scope="props">
          <span v-if="props.column.field == 'actions'">
            <button
              class="btn btn-sm el-square modal-el-margin"
              type="button"
              :title="action.label"
              :data-username="props.row.Identity"
              :data-name="action.name"
              :data-text="action.label"
              @click.left.stop="rowActionFn"
              v-for="action in actions"
              v-bind:class="action.class"
              v-if="action.showWhenStatus == props.row.AccountStatus && action.showForServerRole.includes(serverRole) && action.showForModule.some(p=> modulesEnabled.includes(p))">
              {{ action.label }}
            </button>
          </span>
        </template>
      </vue-good-table>
    </div>

    <div class="modal-wrapper" v-if="u.modalNewUserVisible" v-bind:style="modalNewUserDisplay">
      <div class="modal-dialog modal-lg">
          <div class="modal-content">
          <div class="modal-header">
            <h4>Add new user</h4>
          </div>
          <div class="modal-body">
            <input type="text" class="form-control el-square modal-el-margin" placeholder="Username [_a-zA-Z0-9\.-]" v-model="u.newUserName">
            <input type="password" class="form-control el-square modal-el-margin" minlength="6" autocomplete="off" placeholder="Password [_a-zA-Z0-9\.-]" v-model="u.newUserPassword" v-if="modulesEnabled.includes('passwdAuth')">
          </div>

          <div class="modal-footer justify-content-center" v-if="u.newUserCreateError.length > 0">
            <div class="alert alert-danger" role="alert" >
              {{ u.newUserCreateError }}
            </div>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-success el-square modal-el-margin" v-on:click.stop="createUser()">Create</button>
              <button type="button" class="btn btn-primary el-square d-flex justify-content-sm-end modal-el-margin" v-on:click.stop="u.newUserName='';u.newUserPassword='nopass';u.modalNewUserVisible=false">Close</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-wrapper" v-if="u.modalChangePasswordVisible" v-bind:style="modalChangePasswordDisplay">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h4>Change password for: <strong>{{ username }}</strong></h4>
          </div>
          <div class="modal-body">
            <input type="password" class="form-control el-square modal-el-margin" minlength="6" autocomplete="off" placeholder="Password [_a-zA-Z0-9\.-]" v-model="u.newPassword">
          </div>

          <div class="modal-footer justify-content-center" v-if="u.passwordChangeMessage.length > 0">
            <div class="alert" v-bind:class="passwordChangeStatusCssClass" role="alert" >
              {{ u.passwordChangeMessage }}
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-success el-square modal-el-margin" v-on:click.stop="changeUserPassword(username)">Change password</button>
            <button type="button" class="btn btn-primary el-square d-flex justify-content-sm-end modal-el-margin" v-on:click.stop="u.newPassword='';u.passwordChangeMessage='';u.modalChangePasswordVisible=false">Close</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-wrapper" v-if="u.modalShowConfigVisible" v-bind:style="modalShowConfigDisplay">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h4>OpenVPN config for: <strong>{{ username }}</strong></h4>
          </div>
          <div class="modal-body">
            <div class="d-flex">
              <pre class="modal-show-config-txt-box">{{ u.openvpnConfig }}</pre>
            </div>
          </div>
          <div class="modal-footer">
            <div class="d-flex">
              <button type="button" class="btn btn-success el-square modal-el-margin" v-clipboard:copy="u.openvpnConfig">Copy </button>
              <button type="button" class="btn btn-primary el-square modal-el-margin" v-on:click.stop="u.openvpnConfig='';u.modalShowConfigVisible=false">Cancel</button>
            </div>
          </div>
        </div>
        </div>
      </div>

    <div class="modal-wrapper" v-if="u.modalShowCcdVisible" v-bind:style="modalShowCcdDisplay">
      <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="static-address-label ">Routes table for: <strong>{{ username }}</strong></h3>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <h5 class="static-address-label ">Static address:</h5>
              <input id="static-address" type="text" class="form-control" v-model="u.ccd.ClientAddress" placeholder="127.0.0.1">
              <div class="input-group-append">
                <button id="static-address-clear" class="btn btn-warning" type="button" v-on:click="u.ccd.ClientAddress = 'dynamic'" v-if="serverRole == 'master'" v-bind:disabled="customAddressDynamic">Clear</button>
              </div>
            </div>
          </div>
          <div class="modal-body">
            <div class="d-flex ">
              <table class="table table-bordered table-hover ccd-routes" >
                <thead>
                  <tr>
                    <th scope="col">Address</th>
                    <th scope="col">Mask</th>
                    <th scope="col">Description</th>
                    <th scope="col" v-if="serverRole == 'master'">Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(customRoute, index) in u.ccd.CustomRoutes">
                    <td>
                      <div v-if="serverRole == 'slave'">
                        {{ customRoute.Address }}
                      </div>
                      <input v-if="serverRole == 'master'" v-model="customRoute.Address">
                    </td>
                    <td>
                      <div v-if="serverRole == 'slave'">
                      {{ customRoute.Mask }}
                      </div>
                      <input v-if="serverRole == 'master'" v-model="customRoute.Mask">
                    </td>
                    <td>
                      <div v-if="serverRole == 'slave'">
                      {{ customRoute.Description }}
                      </div>
                      <input v-if="serverRole == 'master'" v-model="customRoute.Description">
                    </td>
                    <td class="text-right" v-if="serverRole == 'master'">
                        <button type="button" class="btn btn-danger btn-sm el-square modal-el-margin" v-if="serverRole == 'master'" v-on:click.stop="u.ccd.CustomRoutes.splice(index, 1)">Delete</button>
                    </td>
                  </tr>
                  <tr v-if="serverRole == 'master'">
                    <td><input type="text" v-model="u.newRoute.Address"/></td>
                    <td><input type="text" v-model="u.newRoute.Mask"/></td>
                    <td><input type="text" v-model="u.newRoute.Description"/></td>
                    <td class="text-right" v-if="serverRole == 'master'">
                      <button type="button" class="btn btn-success el-square modal-el-margin" v-on:click.stop="u.ccd.CustomRoutes.push(u.newRoute);u.newRoute={};">Add</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer justify-content-center" v-if="u.ccdApplyStatusMessage.length > 0">
              <div class="alert" v-bind:class="ccdApplyStatusCssClass" role="alert">
                {{ u.ccdApplyStatusMessage }}
              </div>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-success el-square modal-el-margin" v-if="serverRole == 'master'" v-on:click.stop="ccdApply()">Save</button>
              <button type="button" class="btn btn-primary el-square modal-el-margin" v-on:click.stop="u.ccd={Name:'',ClientAddress:'',CustomRoutes:[]};u.ccdApplyStatusMessage='';u.ccdApplyStatus='';u.modalShowCcdVisible=false">Close</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-wrapper" v-if="u.modalRotateUserVisible" v-bind:style="modalRotateUserDisplay">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h4>Confirm rotating certificates for user: <strong>{{ username }}</strong></h4>
          </div>
          <div class="modal-body" v-if="modulesEnabled.includes('passwdAuth')">
            <h4>Enter new password:</h4>
            <input type="password" class="form-control el-square modal-el-margin" minlength="6" autocomplete="off" placeholder="Password [_a-zA-Z0-9\.-]" v-model="u.newPassword">
          </div>

          <div class="modal-footer justify-content-center" v-if="u.rotateUserMessage.length > 0">
            <div class="alert" v-bind:class="userRotateStatusCssClass" role="alert" >
              {{ u.rotateUserMessage }}
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger el-square modal-el-margin" v-on:click.stop="rotateUser(username)">Rotate</button>
            <button type="button" class="btn btn-primary el-square d-flex justify-content-sm-end modal-el-margin" v-on:click.stop="u.newPassword='';u.rotateUserMessage='';u.modalRotateUserVisible=false">Close</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-wrapper" v-if="u.modalDeleteUserVisible" v-bind:style="modalDeleteUserDisplay">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h4>Confirm deleting user: <strong>{{ username }}</strong></h4>
          </div>

          <div class="modal-footer justify-content-center" v-if="u.deleteUserMessage.length > 0">
            <div class="alert" v-bind:class="deleteUserStatusCssClass" role="alert" >
              {{ u.deleteUserMessage }}
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger el-square modal-el-margin" v-on:click.stop="deleteUser(username)">Delete</button>
            <button type="button" class="btn btn-primary el-square d-flex justify-content-sm-end modal-el-margin" v-on:click.stop="u.deleteUserMessage='';u.modalDeleteUserVisible=false">Close</button>
          </div>
        </div>
      </div>
    </div>

    <notifications position="bottom left" :speed="900" />
  </div>
</div>
<script src="dist/bundle.min.js"></script>
</body>
</html>
